<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trading Terminal ‚Äî Dashboard Theme</title>

  <!-- ‚úÖ Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ‚úÖ Custom CSS -->
  <style>
    /* ===== BASE DASHBOARD THEME ===== */
    body {
      font-family: Arial, sans-serif;
      background-color: #0e1117;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .trading-sim {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      min-height: 100vh;
    }

    /* ===== BACK BUTTON ===== */
    .back-btn {
      background-color: #161b22;
      color: #58a6ff;
      border: 1px solid #30363d;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      width: fit-content;
      margin-bottom: 1rem;
    }
    .back-btn:hover { background-color: #1f242b; }

    /* ===== BALANCE ===== */
    .balance-box {
      background-color: #161b22;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #30363d;
      text-align: center;
      font-size: 1.2rem;
      color: #58a6ff;
    }

    /* ===== TRADE FORM ===== */
    .trade-form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      background-color: #161b22;
      padding: 0.8rem;
      border-radius: 8px;
      border: 1px solid #30363d;
    }
    .sim-input {
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #30363d;
      background-color: #0e1117;
      color: #c9d1d9;
      width: 120px;
      text-align: center;
    }
    .sim-btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    .sim-btn.buy { background-color: #21b0a7; color: #0b0b0d; }
    .sim-btn.sell { background-color: #ff6b6b; color: #fff; }

    /* ===== STOCK CHART ===== */
    .stock-chart {
      background-color: #161b22;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #30363d;
    }
    #stockChart { width: 100%; height: 300px; }

    /* ===== HOLDINGS TABLE ===== */
    .sim-table {
      width: 100%;
      border-collapse: collapse;
      background-color: #161b22;
      border-radius: 8px;
      overflow: hidden;
    }
    .sim-table th, .sim-table td {
      padding: 0.8rem;
      text-align: center;
      border-bottom: 1px solid #30363d;
    }
    .sim-table th { color: #58a6ff; }
    .profit { color: #72ffcb; font-weight: bold; }
    .loss { color: #ff6b6b; font-weight: bold; }
  </style>
</head>
<body>

<section class="trading-sim">
  
  <!-- Back Button -->
  <button class="back-btn" onclick="window.location.href='/dashboard'">‚Üê Back to Dashboard</button>

  <!-- Balance -->
  <div class="balance-box">
    üí∞ Balance: <span id="balance">‚Çπ100000</span>
  </div>

  <!-- Real-Time Stock Chart -->
  <div class="stock-chart">
    <h3 id="chartTitle">Select a stock to view chart</h3>
    <canvas id="stockChart"></canvas>
  </div>

  <!-- Trade Form -->
  <div class="trade-form">
    <input type="text" id="simStockInput" class="sim-input" placeholder="Stock"/>
    <input type="number" id="simQtyInput" class="sim-input" placeholder="Qty"/>
    <button id="buyBtn" class="sim-btn buy">Buy</button>
    <button id="sellBtn" class="sim-btn sell">Sell</button>
  </div>

  <!-- Holdings Table -->
  <table class="sim-table">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Quantity</th>
        <th>Avg Price</th>
        <th>Current Price</th>
        <th>P/L</th>
      </tr>
    </thead>
    <tbody id="holdingsBody"></tbody>
  </table>

</section>

<!-- Trading JS -->
<script>
  const balanceEl = document.getElementById("balance");
  const stockInput = document.getElementById("simStockInput");
  const qtyInput = document.getElementById("simQtyInput");
  const buyBtn = document.getElementById("buyBtn");
  const sellBtn = document.getElementById("sellBtn");
  const holdingsBody = document.getElementById("holdingsBody");

  let balance = 100000;
  let holdings = {};
  const mockPrices = { TCS:3450, INFY:1560, RELIANCE:2410, HDFC:1700 };

  function getPrice(symbol){ return mockPrices[symbol.toUpperCase()] || null; }
  function updateBalance(){ balanceEl.textContent = "‚Çπ" + balance.toFixed(2); }
  function renderHoldings(){
    holdingsBody.innerHTML = "";
    for(let sym in holdings){
      const stock = holdings[sym];
      const currentPrice = getPrice(sym);
      const pl = (currentPrice - stock.avgPrice) * stock.qty;
      const row = document.createElement("tr");
      row.innerHTML = `<td>${sym}</td><td>${stock.qty}</td><td>‚Çπ${stock.avgPrice.toFixed(2)}</td><td>‚Çπ${currentPrice}</td><td class="${pl>=0?'profit':'loss'}">${pl.toFixed(2)}</td>`;
      holdingsBody.appendChild(row);
    }
  }

  function buyStock(){
    const symbol = stockInput.value.trim().toUpperCase();
    const qty = parseInt(qtyInput.value);
    const price = getPrice(symbol);
    if(!symbol||!qty||!price){ alert("Enter valid stock and quantity!"); return; }
    const cost = qty*price;
    if(balance<cost){ alert("Not enough balance!"); return; }
    balance-=cost;
    if(holdings[symbol]){
      const prev=holdings[symbol], newQty=prev.qty+qty, newAvg=((prev.avgPrice*prev.qty)+cost)/newQty;
      holdings[symbol]={qty:newQty, avgPrice:newAvg};
    } else { holdings[symbol]={qty, avgPrice:price}; }
    updateBalance(); renderHoldings(); updateChart(symbol);
  }

  function sellStock(){
    const symbol = stockInput.value.trim().toUpperCase();
    const qty = parseInt(qtyInput.value);
    const price = getPrice(symbol);
    if(!symbol||!qty||!price){ alert("Enter valid stock and quantity!"); return; }
    if(!holdings[symbol]||holdings[symbol].qty<qty){ alert("Not enough holdings!"); return; }
    balance+=qty*price; holdings[symbol].qty-=qty; if(holdings[symbol].qty===0) delete holdings[symbol];
    updateBalance(); renderHoldings(); updateChart(symbol);
  }

  buyBtn.addEventListener("click", buyStock);
  sellBtn.addEventListener("click", sellStock);
  updateBalance(); renderHoldings();

  // ===== Chart.js =====
  const ctx = document.getElementById("stockChart").getContext("2d");
  let chartInstance = new Chart(ctx, { type:'line', data:{labels:[], datasets:[{label:'Price', data:[], borderColor:'#58a6ff', backgroundColor:'rgba(88,166,255,0.2)', tension:0.3}]}, options:{responsive:true, plugins:{legend:{display:false}}, scales:{x:{type:'time', time:{unit:'minute'}}, y:{beginAtZero:false}} } });

  function updateChart(symbol){
    chartInstance.data.labels=[]; chartInstance.data.datasets[0].data=[];
    document.getElementById("chartTitle").textContent=symbol+" Price Chart";
    let price = mockPrices[symbol];
    for(let i=0;i<20;i++){ chartInstance.data.labels.push(new Date(Date.now()-(20-i)*60000)); chartInstance.data.datasets[0].data.push(price+Math.random()*10-5); }
    chartInstance.update();
  }

  stockInput.addEventListener("change",()=>{ const symbol = stockInput.value.trim().toUpperCase(); if(mockPrices[symbol]) updateChart(symbol); });
</script>

</body>
</html>